<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Data</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    
</head>
<body>
    <div class="data-container">
        <h1>Displaying Data from Jetson Nano</h1>
        <div>
            {% if data %}
            <table border="1" cellpadding="5">
                <tr>
                    <th colspan="2">Image</th>
                </tr>
                <tr>
                    <td colspan="2">
                        <img src="{{ data[0]['Image']['S'] }}" alt="Image" style="max-width: 100%; max-height: 200px; width: auto; height: auto; object-fit: contain;">
                    </td>
                </tr>
                <tr>
                    <th colspan="2">GPS Coordinates</th>
                </tr>
                <tr>
                    <td>Latitude:</td>
                    <td>{{ data[0]['GPS']['M']['latitude']['N'] }}</td>
                </tr>
                <tr>
                    <td>Longitude:</td>
                    <td>{{ data[0]['GPS']['M']['longitude']['N'] }}</td>
                </tr>
                <tr>
                    <th colspan="2">Accelerometer Info</th>
                </tr>
                <tr>
                    <td>X:</td>
                    <td>{{ data[0]['Accelerometer']['M']['x']['N'] }}</td>
                </tr>
                <tr>
                    <td>Y:</td>
                    <td>{{ data[0]['Accelerometer']['M']['y']['N'] }}</td>
                </tr>
                <tr>
                    <td>Z:</td>
                    <td>{{ data[0]['Accelerometer']['M']['z']['N'] }}</td>
                </tr>
                <tr>
                    <th colspan="2">Control Info</th>
                </tr>
                {% if 'Control' in data[0] and 'M' in data[0]['Control'] %}
                {% if 'speed' in data[0]['Control']['M'] %}
                <tr>
                    <td>Speed:</td>
                    <td>{{ data[0]['Control']['M']['speed']['N'] }}</td>
                </tr>
                {% endif %}
                {% if 'direction' in data[0]['Control']['M'] %}
                <tr>
                    <td>Direction:</td>
                    <td>{{ data[0]['Control']['M']['direction']['S'] }}</td>
                </tr>
                {% endif %}
                {% if 'mag' in data[0]['Control']['M'] %}
                <tr>
                    <td>Magnitude:</td>
                    <td>{{ data[0]['Control']['M']['mag']['S'] }}</td>
                </tr>
                {% endif %}
                {% if 'Safety' in data[0]['Control']['M'] %}
                <tr>
                    <td>Safety:</td>
                    <td>{{ data[0]['Control']['M']['Safety']['S'] }}</td>
                </tr>
                {% endif %}
                {% endif %}
            </table>
            {% else %}
            <p>No data available</p>
            {% endif %}
        </div>
    </div>

     <!-- Button to stop/start flight -->
     <button id="stopFlightButton" onclick="toggleFlight()">Stop Flight</button>

    <div id="map"></div>
    <script>
        function toggleFlight() {
            var button = document.getElementById("stopFlightButton");
            var newDeliveryStatus = button.textContent === "Stop Flight" ? false : true; // delivery status
            button.disabled = true; // disab;le button to prevent multiple clicks
            fetch('/update_delivery_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    deliveryStatus: newDeliveryStatus,
                }),
            })
            .then(response => response.json())
            .then(data => {
                // change button text and re-enable button after a delay
                setTimeout(function() {
                    button.textContent = newDeliveryStatus ? "Stop Flight" : "Start Flight";
                    button.disabled = false;
                }, 2000); // adjust delay as needed
            })
            .catch(error => {
                console.error('Error:', error);
                button.disabled = false; //  show error
            });
        }
    </script>
</body>
</html>
